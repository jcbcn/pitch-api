variables:
    registryEndpoint: pitch-registry
    dockerRegistry: pitchgame/
trigger:
  paths:
    include:
    - src/api-gateway/*
jobs:
- job: BuildLinux
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: DockerCompose@0
    displayName: Compose build api-gateway
    inputs:
      dockerComposeCommand: 'build pitch.gateway.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/api-gateway/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)
  - task: DockerCompose@0
    displayName: Compose push api-gateway
    inputs:
      dockerComposeCommand: 'push pitch.gateway.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/api-gateway/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)