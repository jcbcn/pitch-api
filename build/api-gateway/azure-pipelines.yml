variables:
    registryEndpoint: pitch-registry
trigger:
  paths:
    include:
    - src/api-gateway/*
jobs:
- job: BuildLinux
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: DockerCompose@0
    displayName: Compose build api-gateway
    inputs:
      dockerComposeCommand: 'build pitch.gateway.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/api-gateway/docker-compose.yml
      qualifyImageNames: true
      projectName: "pitch.gateway.api"
      additionalImageTags: "jcbcn/pitch.gateway.api"
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
  - task: DockerCompose@0
    displayName: Compose push api-gateway
    inputs:
      dockerComposeCommand: 'push jcbcn/pitch.gateway.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/api-gateway/docker-compose.yml
      qualifyImageNames: true
      projectName: "pitch.gateway.api"
      additionalImageTags: "jcbcn/pitch.gateway.api"
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)