variables:
    registryEndpoint: pitch-registry
    dockerRegistry: pitchgame/
trigger:
  paths:
    include:
    - src/store/*
jobs:
- job: BuildLinux
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: DockerCompose@0
    displayName: Compose build store
    inputs:
      dockerComposeCommand: 'build pitch.store.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/store/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)
  - task: DockerCompose@0
    displayName: Compose push store
    inputs:
      dockerComposeCommand: 'push pitch.store.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/store/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)