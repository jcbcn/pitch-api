variables:
    registryEndpoint: pitch-registry
    dockerRegistry: pitchgame/
trigger:
  paths:
    include:
    - src/player/*
jobs:
- job: BuildLinux
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: DockerCompose@0
    displayName: Compose build player
    inputs:
      dockerComposeCommand: 'build pitch.player.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/player/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)
  - task: DockerCompose@0
    displayName: Compose push player
    inputs:
      dockerComposeCommand: 'push pitch.player.api'
      containerregistrytype: Container Registry
      dockerRegistryEndpoint: $(registryEndpoint)
      dockerComposeFile: src/player/docker-compose.yml
      qualifyImageNames: true
      projectName: ""
      dockerComposeFileArgs: |
        TAG=$(Build.SourceBranchName)
        DOCKER_REGISTRY=$(dockerRegistry)